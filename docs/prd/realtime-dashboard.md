# 实时仓位洞察仪表盘 —— 产品功能细节完善版（V1.1）

## 1. 功能摘要（优化版）

> 本仪表盘为散户投资者提供**实时、可操作、可视化**的仓位风险洞察，聚焦四大核心维度：**集中度、资产配置、相关性、流动性冲击**，通过智能预警与分散建议，帮助用户避免“踩雷”、优化持仓结构。

---

## 2. 核心规则细化

### 2.1 单一资产集中度规则（双轨制）

为兼顾**专业性**与**散户友好性**，系统同时支持两套阈值体系，用户可在设置中切换：

| 模式 | 红线 | 黄线 | 安全区 |
|------|------|------|--------|
| **散户模式（默认）** | >10% | 8–10% | <8% |
| **进阶模式** | ≥20% | 18–20% | <18% |

> ✅ **交互说明**：切换模式后，所有图表、预警文案、颜色标识同步更新。

---

### 2.2 资产类型识别与归类逻辑

系统自动识别并归类持仓资产，规则如下：

| 资产类型 | 识别依据 | 归类逻辑 |
|--------|--------|--------|
| 股票 | 证券代码（A股、港股通、美股） | 按个股独立计算 |
| ETF/场内基金 | 代码以51/15/56开头（A股）或含“ETF” | 视为单一资产 |
| 场外基金 | 基金代码（如00XXXX） | 按基金产品独立计算 |
| 可转债 | 代码以11/12开头 | 独立资产 |
| 银行理财/信托/券商资管 | 产品ID + 名称关键词（如“理财”“计划”） | 按产品独立计算 |
| 现金/货币基金 | 余额宝、零钱通等 | 归入“现金类”，**不计入集中度分母**（可配置） |

> ⚠️ **注意**：总市值 = 所有非现金资产市值之和（默认），用户可在设置中选择是否包含现金。

---

## 3. 智能提醒机制（增强版）

### 3.1 触发时机与响应策略

| 触发场景 | 检查频率 | 响应方式 |
|--------|--------|--------|
| 每日收盘后（15:00 A股） | 1次/日 | 推送汇总报告（含超标资产、相关性热力图快照） |
| 单笔买入/卖出后 | 实时（<500ms） | 弹窗预警 + 仪表盘即时刷新 |
| 资产价格波动 >5%（单日） | 实时监听 | 临时检查，若导致集中度越线则触发轻量提醒（Toast） |
| 用户手动刷新 | 按需 | 全量重算 |

### 3.2 提醒文案模板（可本地化）

- **买入前预警**：
  > “⚠️ 买入后【{资产名称}】占比将达 **{new_pct}%**，超过{阈值}%安全线。建议分散投资。”  
  > [继续买入] [取消] [查看分散建议]

- **超标提醒（持仓中）**：
  > “🚨 【{资产名称}】当前占比 **{current_pct}%**，已超安全阈值！点击查看分散方案。”

---

## 4. 散户实用功能增强

### 4.1 买入前预警（交互优化）

- 在交易确认页嵌入**微型仪表盘**：显示当前集中度 + 预估买入后集中度。
- 支持“模拟调整”：用户可滑动调整买入数量，实时看到集中度变化曲线。

### 4.2 分散建议引擎（智能推荐）

> 基于以下规则生成建议：
> - 优先推荐**低相关性**、**高流动性**的宽基ETF
> - 考虑用户历史持仓偏好（如常买沪深300，则优先推荐中证500/科创50）
> - 建议金额 = 超标部分 × 分散比例（默认50%）

**输出格式**：
```
建议将 {X} 元分散至：
• 沪深300ETF（510300）— 相关性 0.3，冲击成本 1.2 bps
• 中证1000ETF（512100）— 相关性 0.1，冲击成本 2.0 bps
[一键生成调仓计划]
```

> ✅ 点击“一键生成”后，跳转至交易页面并预填卖出/买入指令（需用户确认）。

### 4.3 历史集中度趋势图

- **时间范围**：默认7天，可切换至30天
- **交互**：
  - 悬停显示具体日期与占比
  - 点击某日可“回溯”当日持仓快照（仅限本地缓存）
- **视觉**：
  - 红/黄/绿背景色带对应阈值区间
  - 趋势线平滑处理（避免Tick噪音）

---

## 5. 四大核心指标（数据与交互规范）

| 指标 | 数据源 | 更新机制 | 可视化形式 | 用户操作 |
|------|--------|--------|----------|--------|
| **1. 单资产集中度** | 实时行情 + 持仓 | WebSocket（每秒） | 环形图 + 排行榜（Top 5） | 点击资产跳转详情 |
| **2. 大类资产权重** | 自动归类引擎 | 同上 | 饼图 + 可折叠树状列表 | 拖拽调整分类（自定义） |
| **3. 相关性矩阵** | 30日日频收益率 | 每日收盘后计算 | 热力图（红-白-蓝） | 点击单元格显示散点图 |
| **4. 流动性冲击** | Level2深度 + 成交量模型 | 每2分钟快照 | 水平条形图（按资产） | Hover显示模型参数 |

> 🔍 **相关性矩阵补充规则**：
> - 资产 < 3 时：显示提示“至少3项资产方可计算相关性”
> - 新资产加入后：用最近30日数据插值估算（标注“估算”）

---

## 6. 仓位策略辅助（新增模块）

在仪表盘底部增加“**策略参考**”卡片，根据当前持仓状态智能匹配策略：

| 当前状态 | 推荐策略 | 理由 |
|--------|--------|------|
| 单一资产 >15% 且上涨中 | 金字塔加仓？谨慎！ | 避免高位重仓 |
| 多资产高度相关（>0.8） | 动态平衡法 | 降低系统性风险 |
| 现金比例 >30% | 固定比例法 | 逐步建仓 |
| 盈利丰厚但波动加大 | 倒金字塔减仓 | 锁定利润 |

> 💡 点击策略名称可展开说明 + 操作指引。

---

## 7. 边界与错误处理（细化）

| 场景 | 系统行为 | 用户提示 |
|------|--------|--------|
| 休市时段（23:00–08:00） | 图表灰显，禁用交互 | “当前休市，数据将于开盘后更新” |
| 某资产无行情（如停牌） | 使用前收盘价 | Tooltip：“使用前收盘价估算” |
| 冲击成本计算失败 | 显示“–” | Tooltip：“流动性极高或数据缺失” |
| 网络中断（PWA模式） | 使用本地缓存最新快照 | 顶部横幅：“离线模式，数据截至 {时间}” |
| 用户持仓为空 | 显示引导页 | “暂无持仓，买入后自动开启洞察” |

---

## 8. 隐私与安全（强化）

- **数据本地化**：
  - 所有持仓数据仅存储于浏览器 IndexedDB
  - 无任何用户标识上传
- **私密模式保障**：
  - 检测到无痕/隐私模式时，自动禁用所有网络请求（包括行情）
  - 仅使用本地缓存数据渲染（若无缓存则显示空状态）
- **权限最小化**：
  - 不请求地理位置、摄像头、麦克风等无关权限

---

## 9. 验收清单（增强版）

- [x] 任意资产仓位闪电式跨越 20% 时，状态灯 **1 秒内** 由绿变红。  
- [x] 时间滑块拽到 30 d 后，圆环扇区平滑完成重新渲染 ≤400 ms。  
- [x] 移动端 PWA 模式，相关热力图可横滑缩放并保留触摸高亮。  
- [x] 私密模式下无网络访问请求，100% 本地数据零外发。  
- [ ] 用户切换“散户/进阶”模式后，所有阈值与文案实时同步。  
- [ ] 买入模拟器支持滑动调整数量并实时反馈集中度变化。  
- [ ] 相关性热力图点击单元格可查看两资产30日收益率散点图。  
- [ ] 离线状态下仍可查看最近一次完整快照（含图表）。  

---

## 10. 后续扩展建议（Roadmap）

- ✅ V1.1：支持自定义资产分类（如“新能源”“消费”标签）
- ✅ V1.2：接入“压力测试”——模拟大盘下跌10%时的组合回撤
- ✅ V1.3：支持导出PDF报告（含风险评分 + 改进建议）

---

> **交付物说明**：本仪表盘为**单一前端应用**（PWA），依赖用户授权的持仓数据（可通过券商API或手动导入），**不依赖后端服务**，确保隐私与轻量化。

---

如需进一步输出**UI线框图**、**状态机流程图**或**数据模型定义**，我可继续协助。此版本已具备开发就绪条件。