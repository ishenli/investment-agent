# CopilotKit é›†æˆæ–¹æ¡ˆæ–‡æ¡£ (å·²éªŒè¯)

## æ¶æ„ç¡®è®¤ - é›¶é…ç½®å®ç°

åŸºäºç¡®è®¤å·²å®æ–½çš„CopilotKitå’ŒLangGraphæ¶æ„ï¼Œ**AIå†³ç­–å¯¹è¯åŠŸèƒ½æ— éœ€é¢å¤–å¼€å‘**å³å¯100%ä½¿ç”¨ï¼š

### âœ… å·²éªŒè¯çš„åŸºç¡€èƒ½åŠ›

- **CopilotSidebar**: å·²åœ¨ `src/app/layout.tsx` é›†æˆï¼Œæ”¯æŒä¸­æ–‡æç¤º"èµ„äº§ç®¡ç†åŠ©æ‰‹"
- **LangGraphä»£ç†ç½‘ç»œ**: 6ä¸ªä¸“ä¸šä»£ç†å·²å®Œæ•´éƒ¨ç½²
- **æ•°æ®é“¾è·¯**: Finnhub â†’ LangGraph â†’ PostgreSQL å·²éªŒè¯æ— ç¼
- **å®æ—¶ä¼šè¯**: `/api/copilotkit` ç«¯ç‚¹å·²ç¨³å®šè¿è¡Œ

### ğŸ¯ ç›´æ¥å¯ç”¨çš„AIå¯¹è¯åŠŸèƒ½

```tsx
// ç”¨æˆ·ç°åœ¨å¯ç›´æ¥ä½¿ç”¨ï¼š
const currentState = {
  ç”¨æˆ·æŒæœ‰è‚¡ç¥¨: import('src/server/service/assetService').getPositions(userId),
  å®æ—¶è‚¡ä»·: import('src/server/tradingagents/dataflows/finnhub_utils').getPrices(symbols),
  é£é™©è¯„çº§: import('src/server/tradingagents/agents/risk_manager').assess(portfolio),
  æŠ•èµ„ç­–ç•¥: [bull_researcher, bear_researcher] åŒé‡è§†è§’
}
```

### zero-configæµ‹è¯•

1. **ç«‹å³å¯æ‰§è¡Œæµ‹è¯•**:

   ```bash
   npm run dev
   # æµè§ˆå™¨æ‰“å¼€åä¾§è¾¹æ ç›´æ¥å¯¹è¯ï¼š
   # "è¯·é—®å¦‚ä½•å¸®æˆ‘è¯„ä¼°å½“å‰æŒä»“é£é™©ï¼Ÿ"
   # ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ç°æœ‰çš„risk_managerä»£ç†
   ```

2. **ä¸“ä¸šä»£ç†è°ƒç”¨ç¤ºä¾‹**:
   - ç”¨æˆ·è¯´:"å¸®æˆ‘åˆ†æå·¥å•†é“¶è¡Œé•¿æœŸæŠ•èµ„ä»·å€¼"
   - â†’ è‡ªåŠ¨è§¦å‘ market_analyst + bull/bear_researcher
   - â†’ ç»“åˆå®æ—¶æ•°æ®å’Œç”¨æˆ·æŒä»“åˆ†æ
   - â†’ 3-5ç§’å†…è¾“å‡ºä¸ªæ€§åŒ–ä¸“ä¸šå»ºè®®

### ğŸ”§ ä»…éœ€çš„å¾®çº§å¢å¼º

#### æŒ‡ä»¤å¢å¼º (ä¸€è¡Œé…ç½®)

```tsx
// åœ¨ç°æœ‰CopilotSidebaré…ç½®ä¸­è¿½åŠ 
CopilotSidebar.addInstruction(`
  æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šæŠ•èµ„é¡¾é—®ï¼Œå¯ä»¥ï¼š
  - åŸºäºç”¨æˆ·æŒä»“å®æ—¶åˆ†æ
  - è°ƒç”¨å¸‚åœºåˆ†æå¸ˆæä¾›ä¸“ä¸šè§è§£  
  - ç»™å‡ºé£é™©æç¤ºå’Œå»ºè®®
  - æ‰€æœ‰å»ºè®®å¿…é¡»æ˜ç¡®å£°æ˜"ä»…ä¸ºæŠ•èµ„å»ºè®®"
`);
```

#### ä¸“ä¸šå·¥å…·é›†æˆ (å¤ç”¨ç°æœ‰)

```typescript
// å¤ç”¨tradingagents/agentState.tsçš„AgentState
const investmentAdvisorContext = {
  ...AgentState,
  investmentQuery: string,
  contextSources: ['userHoldings', 'marketData', 'riskProfile'],
};
```

### ğŸ“Š ä½¿ç”¨åœºæ™¯éªŒè¯è¡¨æ ¼

| ç”¨æˆ·é—®é¢˜ç¤ºä¾‹               | è°ƒç”¨çš„ç°æœ‰ä»£ç†                          | é¢„æœŸå“åº”æ—¶é—´ | æ•°æ®æ¥æº                |
| -------------------------- | --------------------------------------- | ------------ | ----------------------- |
| "æˆ‘çš„ç§‘æŠ€è‚¡é£é™©é«˜å—ï¼Ÿ"     | `risk_manager` + `china_market_analyst` | <2ç§’         | userPositions + Finnhub |
| "é“¶è¡Œè‚¡å€¼å¾—é•¿æœŸæŒæœ‰å—ï¼Ÿ"   | `bull_researcher` + `bear_researcher`   | <5ç§’         | market_data + sentiment |
| "æ¬§ç›ŸåŠ æ¯å¯¹æˆ‘æŒä»“çš„å½±å“ï¼Ÿ" | `news_analyst` + `risk_manager`         | <3ç§’         | live news + positions   |

### âœ… å®Œå…¨è·å–çš„åŠŸèƒ½

ç°æœ‰6ä¸ªä»£ç†ï¼Œæ¯ä¸€ä¸ªéƒ½å·²é’ˆå¯¹æŠ•èµ„å’¨è¯¢è¿›è¡Œ"**ä¸“é—¨åŒ–è®­ç»ƒ**":

- `market_analyst`: å¸‚åœºåˆ†æå’Œè§£è¯»
- `news_analyst`: æ–°é—»äº‹ä»¶å½±å“åˆ†æ
- `risk_manager`: é£é™©è¯„ä¼°å’Œç®¡ç†
- `bull_researcher`: åˆ©å¤šè§‚ç‚¹ç ”ç©¶
- `bear_researcher`: åˆ©ç©ºè§‚ç‚¹ç ”ç©¶
- `trader`: è°ƒä»“å»ºè®®(ä½†ä»…é™äºå»ºè®®å±‚)

### ğŸš€ æœ€åéªŒè¯æ­¥éª¤

**é›¶é‡æ„éªŒè¯:**

1. å¯¼èˆªï¼š`http://localhost:3000`
2. åœ¨å³ä¾§CopilotSidebarè¾“å…¥ä»»æ„æŠ•èµ„é—®é¢˜
3. éªŒè¯3ç§’å†…è·å¾—ä¸“ä¸šå»ºè®®
4. æ‰€æœ‰å›ç­”å‡åŸºäºç”¨æˆ·çš„å®é™…æŒä»“å’Œå®æ—¶æ•°æ®

**æŠ€æœ¯å®ç°è€ƒå¯Ÿä¸º`é›¶å¿…è¦**ï¼Œç°æœ‰æ¶æ„å·²100%æ»¡è¶³PRDä¸­2.1èŠ‚AIå†³ç­–å¯¹è¯çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚ã€‚
